<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Brandon's Big Board</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>

<style>
body{
  background:black;
  color:white;
  font-family:Arial, sans-serif;
  margin:20px;
}

/* ===== HERO BANNER ===== */
.hero-banner{
  background:linear-gradient(135deg,#0a0a0a,#1a1a1a);
  border:1px solid #222;
  padding:40px 20px;
  margin-bottom:30px;
  text-align:center;
}

.hero-content h1{
  font-size:36px;
  margin:0;
  letter-spacing:2px;
  font-weight:700;
}

.hero-content h2{
  font-size:22px;
  margin:10px 0;
  color:#4169E1;
  font-weight:600;
}

.meta-info{
  margin-top:12px;
  font-size:13px;
  color:#ccc;
}

.meta-info span{
  margin:0 12px;
}

/* ===== LOGOS ===== */
.logo-container{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:40px;
  margin-bottom:20px;
}

.logo-container img{
  height:150px;
}

/* ===== CONTROLS ===== */
.controls{
  text-align:center;
  margin-bottom:15px;
}

input, select{
  padding:6px;
  margin:5px;
  font-size:14px;
  background:#111;
  color:white;
  border:1px solid #444;
}

/* ===== TABLE ===== */
.table-wrapper{
  overflow:auto;
  max-height:75vh;
  border:1px solid #222;
}

table{
  border-collapse:separate;
  border-spacing:0;
  width:100%;
  min-width:max-content;
}

th, td{
  padding:8px 14px;
  text-align:center;
  white-space:nowrap;
}

th{
  background:#4169E1;
  cursor:pointer;
  position:sticky;
  top:0;
  z-index:200;
  transition:background .2s ease;
}

th:hover{
  background:#3154b3;
}

/* Hide arrows by default */
th .arrow{
  display:inline-block;
  margin-left:6px;
  transition:transform .25s ease, opacity .2s ease;
  opacity:0;
}

/* Show arrow on hover */
th:hover .arrow{
  opacity:.4;
}

/* Show fully when sorted */
th.sorted .arrow{
  opacity:1;
}

th.sorted.asc .arrow{ transform:rotate(0deg); }
th.sorted.desc .arrow{ transform:rotate(180deg); }

tbody tr:nth-child(odd){ background:#000; }
tbody tr:nth-child(even){ background:#111; }
tbody tr:hover{ background:#1a1a1a; }

.sticky-col{
  position:sticky;
  background-clip:padding-box;
  border-right:1px solid #222;
}

tbody tr:nth-child(odd) .sticky-col{ background:#000; }
tbody tr:nth-child(even) .sticky-col{ background:#111; }
tbody tr:hover .sticky-col{ background:#1a1a1a; }

.sticky-1{ z-index:150; }
.sticky-2{ z-index:151; }
.sticky-3{ 
  z-index:152;
  box-shadow:6px 0 10px rgba(0,0,0,.7);
}

thead .sticky-1{ z-index:300; }
thead .sticky-2{ z-index:301; }
thead .sticky-3{ z-index:302; }

td:first-child{
  font-weight:bold;
}
</style>
</head>

<body>

<!-- HERO -->
<div class="hero-banner">
  <div class="hero-content">
    <h1>Brandon's Big Board 2026</h1>
    <h2>2026 NFL Draft Database</h2>
    <div class="meta-info">
      <span id="prospectCount">Prospects: --</span>
      <span id="lastUpdated">Last Synced: --</span>
    </div>
  </div>
</div>

<div class="logo-container">
  <img src="NFLLogo.png">
  <img src="Draft26.jpg">
</div>

<div class="controls">
  <input type="text" id="searchBox" placeholder="Search players...">
  <select id="positionFilter">
    <option value="ALL">All Positions</option>
  </select>
</div>

<div class="table-wrapper">
<table id="data-table">
  <thead></thead>
  <tbody></tbody>
</table>
</div>

<script>

const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ0uaGV-62aAS74y5I-HVKCtGd8l5vy0iaNOErDHjQBFXNt2kDKhAEUMRQDGckqQoJqjUtwnKqTWqgR/pub?gid=0&single=true&output=csv";

let tableData = [];
let headers = [];
let posIndex = -1;
let currentSort = -1;
let sortAsc = true;

/* ===== LOAD DATA ===== */
Papa.parse(csvUrl,{
  download:true,
  skipEmptyLines:true,
  complete:function(results){

    headers = results.data[1].map(h => h.trim());
    tableData = results.data.slice(2)
      .filter(r => r.length === headers.length);

    posIndex = headers.findIndex(h =>
      h.toLowerCase().includes("pos")
    );

    createHeaders();
    populateFilter();
    displayRows();
    fetchLastUpdated();
  }
});

/* ===== LAST SYNC TIME ===== */
function fetchLastUpdated(){
  const now = new Date();
  document.getElementById("lastUpdated").textContent =
    "Last Synced: " + now.toLocaleString();
}

/* ===== PROSPECT COUNT ===== */
function updateProspectCount(count){
  document.getElementById("prospectCount").textContent =
    "Prospects: " + count;
}

/* ===== HEADERS ===== */
function createHeaders(){
  const thead = document.querySelector("#data-table thead");
  thead.innerHTML="";
  const row=document.createElement("tr");

  headers.forEach((h,i)=>{
    const th=document.createElement("th");
    th.innerHTML = h + '<span class="arrow">â–²</span>';

    if(i<3){
      th.classList.add("sticky-col","sticky-"+(i+1));
    }

    th.onclick=()=>sortTable(i);
    row.appendChild(th);
  });

  thead.appendChild(row);
}

/* ===== SORTING ===== */
function sortTable(col){

  if(currentSort===col){
    sortAsc=!sortAsc;
  } else{
    currentSort=col;
    sortAsc=true;
  }

  const isHeightColumn = headers[col].toLowerCase().includes("height");

  tableData.sort((a,b)=>{
    let A=a[col]||"";
    let B=b[col]||"";

    if(isHeightColumn){
      const convertHeight = (h)=>{
        const match = h.match(/(\d+)'(\d+(\.\d+)?)"?/);
        if(!match) return 0;
        return (parseFloat(match[1])*12)+parseFloat(match[2]);
      };
      return sortAsc
        ? convertHeight(A)-convertHeight(B)
        : convertHeight(B)-convertHeight(A);
    }

    if(!isNaN(parseFloat(A)) && !isNaN(parseFloat(B))){
      return sortAsc ? parseFloat(A)-parseFloat(B)
                     : parseFloat(B)-parseFloat(A);
    }

    return sortAsc ? A.localeCompare(B)
                   : B.localeCompare(A);
  });

  updateHeaderStyles();
  displayRows();
}

function updateHeaderStyles(){
  document.querySelectorAll("th").forEach((th,i)=>{
    th.classList.remove("sorted","asc","desc");
    if(i===currentSort){
      th.classList.add("sorted");
      th.classList.add(sortAsc ? "asc" : "desc");
    }
  });
}

function applyStickyOffsets(){
  const firstRow = document.querySelector("#data-table tbody tr");
  if(!firstRow) return;

  let leftOffset = 0;

  for(let i=0;i<3;i++){
    const width = firstRow.children[i].offsetWidth;

    document.querySelectorAll(
      `td:nth-child(${i+1}), th:nth-child(${i+1})`
    ).forEach(cell=>{
      cell.style.left = leftOffset + "px";
    });

    leftOffset += width;
  }
}

function populateFilter(){
  if(posIndex===-1) return;

  const set=new Set();
  tableData.forEach(r=>set.add(r[posIndex]));

  const filter=document.getElementById("positionFilter");

  set.forEach(p=>{
    const opt=document.createElement("option");
    opt.value=p;
    opt.textContent=p;
    filter.appendChild(opt);
  });

  filter.onchange=displayRows;
}

document.getElementById("searchBox")
  .addEventListener("input",displayRows);

/* ===== DISPLAY ===== */
function displayRows(){
  const tbody=document.querySelector("#data-table tbody");
  tbody.innerHTML="";

  const pos=document.getElementById("positionFilter").value;
  const search=document.getElementById("searchBox").value.toLowerCase();

  let visibleCount = 0;

  tableData.forEach(r=>{
    if(posIndex!==-1 && pos!=="ALL" && r[posIndex]!==pos) return;
    if(search && !r.join(" ").toLowerCase().includes(search)) return;

    visibleCount++;

    const tr=document.createElement("tr");

    r.forEach((c,i)=>{
      const td=document.createElement("td");
      td.textContent=c;

      if(i<3){
        td.classList.add("sticky-col","sticky-"+(i+1));
      }

      tr.appendChild(td);
    });

    tbody.appendChild(tr);
  });

  updateProspectCount(visibleCount);
  applyStickyOffsets();
}

window.addEventListener("resize", applyStickyOffsets);

</script>

</body>
</html>
