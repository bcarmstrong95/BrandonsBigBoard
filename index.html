<script>
let sortDirection = 1;
let currentSortedColumn = -1;

function sortTable(columnIndex) {
    const table = document.getElementById("dataTable");
    const tbody = table.tBodies[0];
    const rows = Array.from(tbody.rows);

    sortDirection = (currentSortedColumn === columnIndex) ? -sortDirection : 1;
    currentSortedColumn = columnIndex;

    rows.sort((a, b) => {
        let x = a.cells[columnIndex].innerText.trim();
        let y = b.cells[columnIndex].innerText.trim();

        let numX = parseFloat(x);
        let numY = parseFloat(y);

        if (!isNaN(numX) && !isNaN(numY)) {
            return (numX - numY) * sortDirection;
        }
        return x.localeCompare(y) * sortDirection;
    });

    rows.forEach(row => tbody.appendChild(row));

    updateArrows(columnIndex);
    highlightSortedColumn(columnIndex);

    // reapply search highlighting after sort
    applySearchHighlight();
}

function updateArrows(columnIndex) {
    const arrows = document.querySelectorAll("th .arrow");
    arrows.forEach(a => a.textContent = "");
    arrows[columnIndex].textContent = sortDirection === 1 ? "▲" : "▼";
}

function highlightSortedColumn(columnIndex) {
    // remove column highlight only
    document.querySelectorAll(".sorted-column")
        .forEach(cell => cell.classList.remove("sorted-column"));

    document.querySelectorAll("#dataTable tr").forEach(row => {
        if (row.cells[columnIndex]) {
            row.cells[columnIndex].classList.add("sorted-column");
        }
    });
}

/* SEARCH FUNCTION */
document.getElementById("searchBox").addEventListener("keyup", applySearchHighlight);

function applySearchHighlight() {
    const filter = document.getElementById("searchBox").value.toLowerCase();
    const rows = document.querySelectorAll("#dataTable tbody tr");

    rows.forEach(row => {
        const text = row.innerText.toLowerCase();
        const match = text.includes(filter);

        row.style.display = match ? "" : "none";

        if (filter !== "" && match) {
            row.classList.add("match");
        } else {
            row.classList.remove("match");
        }
    });
}
</script>
