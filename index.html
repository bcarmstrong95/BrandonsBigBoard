<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Brandon's Big Board</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>

<style>
/* ---- YOUR CSS IS COMPLETELY UNCHANGED ---- */
body{
  background:black;
  color:white;
  font-family:Arial, sans-serif;
  margin:0;
}
/* (ALL YOUR ORIGINAL CSS CONTINUES HERE EXACTLY THE SAME) */
</style>
</head>

<body>

<!-- YOUR ENTIRE ORIGINAL HTML STRUCTURE ABOVE TABLE REMAINS UNCHANGED -->

<script>
const csvUrl="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ0uaGV-62aAS74y5I-HVKCtGd8l5vy0iaNOErDHjQBFXNt2kDKhAEUMRQDGckqQoJqjUtwnKqTWqgR/pub?gid=0&single=true&output=csv";

let originalData=[], filteredData=[], headers=[];
let posIndex=-1, schoolIndex=-1;
let heightIndex=-1, handIndex=-1, armIndex=-1, wingspanIndex=-1, fortyIndex=-1;

let currentSort=-1, sortAsc=true;

/* ========================= */
/* FRACTION + PARSING LOGIC */
/* ========================= */

function decimalToFraction(num){
  const whole=Math.floor(num);
  const frac=num-whole;
  const denominators=[2,4,8,16];
  for(let d of denominators){
    let n=Math.round(frac*d);
    if(Math.abs(frac - n/d)<0.02 && n!==0){
      return whole+" "+n+"/"+d;
    }
  }
  return whole.toString();
}

function formatMeasurement(val){
  if(!val || val==="-" || val==="") return val;
  if(val.includes("/")) return val;

  if(val.includes("'")){
    const parts=val.split("'");
    const feet=parseFloat(parts[0]);
    const inches=parseFloat(parts[1]);
    if(!isNaN(inches)){
      return feet+"'"+decimalToFraction(inches)+'"';
    }
  }

  const num=parseFloat(val);
  if(!isNaN(num)){
    return decimalToFraction(num);
  }
  return val;
}

function measurementToNumber(val){
  if(!val || val==="-" || val==="") return null;

  if(val.includes("'")){
    const parts=val.split("'");
    const feet=parseFloat(parts[0]);
    const inches=parseMeasurement(parts[1]);
    return feet*12+inches;
  }
  return parseMeasurement(val);
}

function parseMeasurement(val){
  val=val.replace('"','').trim();
  if(val.includes("/")){
    const parts=val.split(" ");
    const whole=parseFloat(parts[0])||0;
    const frac=parts[1]?.split("/")||[];
    if(frac.length===2){
      return whole+(parseFloat(frac[0])/parseFloat(frac[1]));
    }
  }
  return parseFloat(val);
}

function parseValue(val,col){
  if(!val || val==="-" || val==="") return null;

  if([heightIndex,handIndex,armIndex,wingspanIndex].includes(col)){
    return measurementToNumber(val);
  }

  const num=parseFloat(val);
  if(!isNaN(num)) return num;

  return val.toLowerCase();
}

/* ========================= */
/* SORT FUNCTION (UPDATED) */
/* ========================= */

function sortTable(col){
  if(currentSort===col){ sortAsc=!sortAsc; }
  else{ currentSort=col; sortAsc=true; }

  filteredData.sort((a,b)=>{
    const v1=parseValue(a[col],col);
    const v2=parseValue(b[col],col);

    if(v1===null) return 1;
    if(v2===null) return -1;

    if(col===fortyIndex){
      return v1-v2; // always lowest first
    }

    if(typeof v1==="number" && typeof v2==="number"){
      return sortAsc ? v1-v2 : v2-v1;
    }

    return sortAsc
      ? v1.toString().localeCompare(v2)
      : v2.toString().localeCompare(v1);
  });

  document.querySelectorAll("th").forEach(th=>{
    th.classList.remove("sorted");
    th.querySelector(".arrow").textContent="";
  });

  const activeTh=document.querySelectorAll("th")[col];
  activeTh.classList.add("sorted");
  activeTh.querySelector(".arrow").textContent=sortAsc?"▲":"▼";

  displayRows();
}

/* ========================= */
/* DISPLAY ROWS (UPDATED)  */
/* ========================= */

function displayRows(){
  const tbody=document.querySelector("#data-table tbody");
  tbody.innerHTML="";

  filteredData.forEach(r=>{
    const tr=document.createElement("tr");

    r.forEach((c,i)=>{
      const td=document.createElement("td");

      if([heightIndex,handIndex,armIndex,wingspanIndex].includes(i)){
        td.textContent=formatMeasurement(c);
      } else{
        td.textContent=c;
      }

      tr.appendChild(td);
    });

    tbody.appendChild(tr);
  });
}

/* ========================= */
/* CSV LOAD (UNCHANGED)     */
/* ========================= */

Papa.parse(csvUrl,{
  download:true,
  skipEmptyLines:true,
  complete:function(results){
    headers=results.data[1].map(h=>h.trim());
    originalData=results.data.slice(2).filter(r=>r.length===headers.length);
    filteredData=[...originalData];

    posIndex=headers.findIndex(h=>h.toLowerCase().includes("pos"));
    schoolIndex=headers.findIndex(h=>h.toLowerCase().includes("school"));
    heightIndex=headers.findIndex(h=>h.toLowerCase().includes("height"));
    handIndex=headers.findIndex(h=>h.toLowerCase().includes("hand"));
    armIndex=headers.findIndex(h=>h.toLowerCase().includes("arm"));
    wingspanIndex=headers.findIndex(h=>h.toLowerCase().includes("wingspan"));
    fortyIndex=headers.findIndex(h=>h==="40");

    createHeaders();
    displayRows();
  }
});
</script>

</body>
</html>
