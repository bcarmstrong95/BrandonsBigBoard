<script>
document.addEventListener("DOMContentLoaded", () => {
  const table = document.querySelector("table");
  const headers = table.querySelectorAll("th");
  const tbody = table.querySelector("tbody");
  const searchInput = document.getElementById("search");

  let currentSortCol = -1;
  let sortAsc = true;

  // SORTING
  headers.forEach((header, index) => {
    header.addEventListener("click", () => {
      const rows = Array.from(tbody.querySelectorAll("tr"));

      sortAsc = currentSortCol === index ? !sortAsc : true;
      currentSortCol = index;

      rows.sort((a, b) => {
        let A = a.children[index].innerText.trim().toLowerCase();
        let B = b.children[index].innerText.trim().toLowerCase();

        const numA = parseFloat(A);
        const numB = parseFloat(B);

        if (!isNaN(numA) && !isNaN(numB)) return sortAsc ? numA - numB : numB - numA;
        return sortAsc ? A.localeCompare(B) : B.localeCompare(A);
      });

      tbody.innerHTML = "";
      rows.forEach(row => tbody.appendChild(row));

      highlightSortedColumn();
    });
  });

  function highlightSortedColumn() {
    // remove existing highlights
    document.querySelectorAll(".sorted-col").forEach(el =>
      el.classList.remove("sorted-col")
    );

    if (currentSortCol === -1) return;

    // highlight header
    headers[currentSortCol].classList.add("sorted-col");

    // highlight cells
    tbody.querySelectorAll("tr").forEach(row => {
      row.children[currentSortCol].classList.add("sorted-col");
    });
  }

  // SEARCH FILTER
  searchInput.addEventListener("keyup", () => {
    const term = searchInput.value.toLowerCase();

    tbody.querySelectorAll("tr").forEach(row => {
      const text = row.innerText.toLowerCase();
      if (text.includes(term)) {
        row.style.display = "";
        row.classList.add("filtered-highlight");
      } else {
        row.style.display = "none";
        row.classList.remove("filtered-highlight");
      }
    });
  });
});
</script>
